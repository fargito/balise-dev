{% extends 'base.html' %}

{% load static %}

{% block content %}
	<section class="binet-title-and-return-container">
		<div class="binets-return-button">
			
		</div>
		<h3 class='print-hidden'>Exporter des listes de binets</h3>
		<div class='binets-side-button'>
			
		</div>
	</section>
	<section id='compta-seance-cheques-form-container'>
		<form method='post' action=''>
			<table class='compta-width100 print-hidden'>
				<caption class='print-hidden'>Rechercher des mandats</caption>
				<tr>
					<td colspan='6'>
						{{ search_binet_form.non_field_errors }}
					</td>
				</tr>
				<tr>
					<th class='compta-search-form'>{{ search_binet_form.binet.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.promotion.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.type_binet.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.categorie.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.active_only.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.is_last_only.label }}</th>
					<th class='compta-search-form'>{{ search_binet_form.public_only.label }}</th>
				</tr>
				<tr>
					<td class='compta-search-form'>{{ search_binet_form.binet.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.promotion.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.type_binet.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.categorie.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.active_only.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.is_last_only.errors }}</td>
					<td class='compta-search-form'>{{ search_binet_form.public_only.errors }}</td>
				</tr>
				<tr>
					<td class='compta-search-form'>{{ search_binet_form.binet }}</td>
					<td class='compta-search-form'>{{ search_binet_form.promotion }}</td>
					<td class='compta-search-form'>{{ search_binet_form.type_binet }}</td>
					<td class='compta-search-form'>{{ search_binet_form.categorie }}</td>
					<td class='compta-search-form'>{{ search_binet_form.active_only }}</td>
					<td class='compta-search-form'>{{ search_binet_form.is_last_only }}</td>
					<td class='compta-search-form'>{{ search_binet_form.public_only }}</td>
					<td class='compta-search-form'><input type="submit" name="validation" value="Rechercher" /></td>
					<td class='compta-search-form'><input type="submit" name="validation" value="Annuler" /></td>
				</tr>
			</table>
			{% csrf_token %}
		</form>
	</section>
	<!-- Here we put in print-only a description of the search -->
	<section class="binets-result-print-description print-only">
		<h3 class='txtcentre'>Liste des binets</h3>
		<div class='txtcentre'>Imprimée le {% now "SHORT_DATETIME_FORMAT" %}</div>
		Cette liste regroupe les mandats :
		<ul>
			{% if cleaned_data.promotion %}
				<li>
					Uniquement promo
					{% for promotion in cleaned_data.promotion %}
						{{ promotion }}, 
					{% endfor %}
				</li>
			{% else %}
				<li>De toutes les promos</li>
			{% endif %}
			{% if cleaned_data.type_binet %}
				<li>
					De type
					{% for type_binet in cleaned_data.type_binet %}
						{{ type_binet }}, 
					{% endfor %}
				</li>
			{% else %}
				<li>De toutes les types</li>
			{% endif %}
			{% if cleaned_data.categorie %}
				<li>
					De catégorie
					{% for categorie in cleaned_data.categorie %}
						{{ categorie }}, 
					{% endfor %}
				</li>
			{% else %}
				<li>De toutes les catégories</li>
			{% endif %}






			{% if active_only %}
				<li>Actifs (dont le mandat n'est pas clôturé)</li>
			{% endif %}
			{% if is_last_only %}
				<li>Les plus récents (dont les successeurs ne sont pas connus)</li>
			{% endif %}
		</ul>
		{% if not public_only %}
			ATTENTION CETTE LISTE CONTIENT DES BINETS MARQUES COMME NON PUBLICS ! NE PAS DIFFUSER EN DEHORS DE LA KES
		{% endif %}
	</section>
	<section id="table-container">
		<table id="liste-binets">
			<thead class="liste-binets">
				<caption class='print-hidden'>Résultats de la recherche ({{ n_mandats }})</caption>
				<tr>
					<th class="nom-binet">Binet</th>
					<th class="binet-promotion">Promotion</th>
					<th class="binet-description">Description</th>
					<th class="binet-user">Président</th>
					<th class="binet-user">Trésorier</th>
				</tr>
			</thead>
			<tbody>
				{% for mandat in mandats %}
					<tr class="mandat">
						<td class="nom-binet">
							<strong><a href={{ mandat.binet.get_history_url }}>{{ mandat.binet.nom }}</a> </strong>
						</td>
						<td class="binet-promotion">{{ mandat.promotion }}</td>
						<td class="binet-description">
							{{ mandat.binet.description }}
						</td>
						<td class="binet-user">
							<a href={{ mandat.president.eleve.get_infos_url }}>{{ mandat.president }}</a>
						</td>
						<td class="binet-user">
							<a href={{ mandat.tresorier.eleve.get_infos_url }}>{{ mandat.tresorier }}</a>
						</td>
					</tr>

				{% endfor %}
			</tbody>
		</table>
	</section>
	{% if not public_only %}
		<footer class="print-watermark print-only">DIFFUSION RESTREINTE KES</footer>
	{% endif %}
{% endblock %}