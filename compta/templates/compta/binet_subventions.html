{% extends 'compta/journal.html' %}
{# cette page récupère le menu de la page journal #}
{% load static %}

{% block compta_page %}
	<div id="compta-table-container">
		<div id="view-deblocages-title">
			Déblocage des subventions
		</div>
		<div class="subvention-tables_container">
			{% for subvention in subventions %}
			<div class="subventions-deblocages-and-lignes-container">
				<table class="subventions-deblocages-table">
					<caption>{{ subvention.vague.type_subvention }} {{ subvention.vague.annee }}</caption>
					<head>
						<tr>
							<th class='subventions-deblocages-postes'>Postes de dépenses</th>
							<th class="subventions-deblocages-montant">Somme accordée</th>
							<th class="subventions-deblocages-montant">Somme débloquée</th>
							<th class="subventions-deblocages-montant">Reste</th>
						</tr>
					</head>
					<body>
						<tr class="subventions-deblocages-recap">
							<td class="subventions-deblocages-postes">{{ subvention.postes|linebreaks }}</td>
							<td class="subventions-deblocages-montant">{{ subvention.accorde }}</td>
							<td class="subventions-deblocages-montant">{{ subvention.get_deblocages_total }}</td>
							<td class="subventions-deblocages-montant">{{ subvention.get_rest }}</td>

						</tr>
					</body>
				</table>
				<table class="subventions-deblocage-lignes">
					<thead>
						<tr>
							<th>
								Effectée le
							</th>
							<th class="compta-form-description">
								Description
							</th>
							<th class="compta-form-montant">
								Débit
							</th>
							{% for subvention_bis in subventions %}
							<th class="compta-form-montant">{{ subvention_bis.vague.type_subvention }} {{ subvention_bis.vague.annee }}</th>
							{% endfor %}
						</tr>
					</thead>
					<tbody class="subventions-deblocage-lignes">
					{% for deblocage in subvention.get_deblocages_list %}
						<tr class="ligne-compta">
							<td class="compta-form-date">{{ deblocage.ligne_compta.date|date:'d/m/Y' }}</td>
							{# si l'utilisateur peut éditer le journal, le lien de la description l'amène directement à edit. Sinon à view #}
							{% if request.session.edit %}
								<td class="compta-form-description"><a href={{ deblocage.ligne_compta.edit_self_link }}>{{ deblocage.ligne_compta.description }}</a></td>
							{% else %}
								<td class="compta-form-description"><a href={{ deblocage.ligne_compta.view_self_link }}>{{ deblocage.ligne_compta.description }}</a></td>
							{% endif %}
							<td class="compta-form-montant">{% if deblocage.ligne_compta.debit %}{{ deblocage.ligne_compta.debit|default_if_none:"" }}{% endif %}</td>
							{% for nom_vague, montant_deblocage in deblocage.ligne_compta.get_deblocages %}
								<td class="compta-form-montant">
									<div class="compta-deblocage">
										{% if montant_deblocage %}{{ montant_deblocage|default_if_none:"" }}{% endif %}
									</div>
								</td>
							{% endfor %}
							{% if request.session.edit %}
							<td class="compta-button-container">
								<a href={{ deblocage.ligne_compta.edit_self_link }}>
									<img src="{% static 'img/edit.ico' %}" alt="Edit icone" class='edit_icon' label="Modifier la ligne"/>
								</a>
							</td>
							<td class="compta-button-container">
								<a href={{ deblocage.ligne_compta.delete_self_link }}>
									<img src="{% static 'img/delete.ico' %}" alt="Delete icone" class='delete_icon'/>
								</a>
							</td>
						{% endif %}
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
			{% endfor %}
	</div>
{% endblock %}